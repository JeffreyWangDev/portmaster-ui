<div class="w-full gap-4 p-4 dashboard-grid">
  <header class="flex flex-row items-center justify-between w-full" id="header">
    <h1 class="flex flex-col flex-grow text-lg font-light text-white">
      Dashboard
      <span class="text-sm font-normal text-secondary">Welcome back
        <ng-container *ngIf="!!profile">
          , <span class="text-primary">{{ profile.username }}</span>!
        </ng-container>
      </span>
    </h1>

    <div class="flex flex-row gap-8">
      <ng-container *ngIf="!!profile">
        <div class="flex flex-col text-xs leading-4">
          <span class="font-light text-secondary">Your current plan is <span
              class="font-normal text-green-300">{{ profile.current_plan?.name || 'N/A' }}</span></span>
          <span class="font-light text-secondary">and ends {{ profile.subscription ? ' in ': ''}} <span
              class="font-normal text-primary">
              {{ profile.subscription ? (profile.subscription.ends_at | timeAgo) : 'never'}}
            </span></span>
        </div>

        <button *ngIf="profile.subscription" (click)="openAccountDetails()"
          class="text-xs font-normal text-white cursor-pointer btn bg-blue bg-opacity-80 hover:bg-opacity-100 hover:bg-blue">
          Account Details
        </button>

        <button *ngIf="!profile.subscription" (click)="openAccountDetails()"
          class="text-xs font-normal text-white cursor-pointer btn bg-blue bg-opacity-80 hover:bg-opacity-100 hover:bg-blue">
          Subscribe
        </button>

      </ng-container>
    </div>
  </header>


  <div class="feature-card-container" id="features">
    <label>
      Features
    </label>

    <div class="feature-card-list">
      <app-feature-card *ngFor="let feature of (features$ | async)" [feature]="feature" [disabled]="!feature.enabled">
      </app-feature-card>
    </div>

    <span class="font-light text-xxs text-primary">
      Want more features?
      <a href="https://safing.io/pricing/?source=portmaster" class="font-normal underline text-primary">Upgrade your
        plan now! ðŸš€</a>
      or
      <a href="https://safing.io/pricing/#comparison?source=portmaster" class="font-normal underline text-primary">find
        out more</a>
    </span>
  </div>


  <div class="feature-card-container" id="stats">
    <label>
      Statistics
    </label>

    <!-- Mini Stats -->
    <div class="mini-stats-list">
      <div class="mini-stat">
        <label>Trackers Blocked</label>
        <span>1.2k</span>
      </div>

      <div class="mini-stat">
        <label>Active Connections</label>
        <span>{{ activeConnections }}</span>
      </div>

      <div class="mini-stat">
        <label>Active Apps</label>
        <span>{{ activeProfiles }}</span>
      </div>

      <div class="mini-stat">
        <label>Data Sent</label>
        <span>
          {{ featureBw ? (dataOutgoing | bytes) : 'N/A'}}
        </span>
      </div>

      <div class="mini-stat">
        <label>Data Received</label>
        <span>
          {{ featureBw ? (dataIncoming | bytes) : 'N/A'}}
        </span>
      </div>

      <div class="mini-stat">
        <label>SPN Identities</label>
        <span>{{ featureSPN ? activeIdentities : 'N/A' }}</span>
      </div>
    </div>
  </div>

  <div class="feature-card-container" id="charts">
    <label>
      Active/Blocked Connections
    </label>
    <div class="mini-stats-list">
      <div class="mini-stat">
        <sfng-netquery-line-chart class="w-full h-36" [data]="connectionChart"></sfng-netquery-line-chart>
      </div>
    </div>
  </div>

  <div class="flex-grow feature-card-container" id="countries">
    <label>
      Recent Connections per Country
    </label>
    <div class="block w-full">
      <ul class="list-none auto-grid-4">
        <li *ngFor="let country of (connectionsPerCountry | keyvalue); trackBy: trackCountry"
          [routerLink]="['/monitor']" [queryParams]="{q: 'country:' + country.key}"
          (mouseenter)="onCountryHover(country.key)" (mouseleave)="onCountryHover(null)"
          class="flex flex-row items-center p-2 bg-gray-300 rounded-md cursor-pointer hover:bg-gray-400">
          <div class="flex flex-row items-center flex-grow gap-2">
            <span class="flex-shrink-0" *ngIf="!!country.key" [appCountryFlags]="country.key"></span>
            <span
              class="overflow-hidden text-xs text-secondary whitespace-nowrap">{{ countryNames[country.key] || country.key || 'N/A' }}</span>
          </div>
          <span class="ml-2">{{ country.value }}</span>
        </li>
      </ul>
    </div>
  </div>

  <div class="flex-grow feature-card-container" id="blocked">
    <label>
      Recently Blocked Applications
    </label>
    <div class="block w-full">
      <span *ngIf="!(blockedProfiles |keyvalue)?.length" class="flex flex-row items-center justify-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
        </svg>

        <span>
          No applications have been blocked in the last 10 minutes.
        </span>
      </span>

      <ul class="list-none auto-grid-3">
        <li *ngFor="let profile of (blockedProfiles | keyvalue); trackBy: trackApp"
          (mouseenter)="onProfileHover(profile.key)" (mouseleave)="onProfileHover(null)"
          [routerLink]="['/app', profile.value.profile.Source, profile.value.profile.ID]"
          class="flex flex-row items-center p-2 bg-gray-300 rounded-md cursor-pointer hover:bg-gray-400">
          <div class="flex flex-row items-center flex-grow gap-2">
            <app-icon [profile]="profile.value.profile"></app-icon>
            <span class="text-xs text-secondary">{{ profile.value.profile.Name }}</span>
          </div>
          {{ profile.value.count }}
        </li>
      </ul>
    </div>
  </div>

  <div class="flex-grow feature-card-container" id="connmap">
    <label>
      Connection Targets
    </label>
    <div class="block w-full h-96" #map>
    </div>
  </div>
</div>
