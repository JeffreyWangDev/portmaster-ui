<div class="relative flex flex-row flex-wrap items-center px-5 py-5 bg-gray-200 border-l border-transparent rounded-r"
  [class.pr-8]="lockDefaults" [ngClass]="{
    'border-blue': _setting?.Value !== undefined && !rejected,
    'border-red': rejected,
    'rounded-l': !rejected && _setting?.Value === undefined
  }">
  <div class="flex flex-col flex-grow">
    <div class="flex flex-row items-center justify-start space-x-2 w-fit">
      <h3 [innerHTML]="setting?.Name | safe:'html'" class="mb-0 name"></h3>
      <app-tipup *ngIf="setting?.Description" [key]="setting!.Key" [text]="setting?.Description"
        [buttons]="tipupButtons" [title]="setting?.Name"></app-tipup>

      <span *ngIf="changeAccepted || restartPending" (click)="restartNow()"
        class="px-1.5 py-0.5 border  rounded inline-flex justify-evenly items-center text-xxs mb-0.5" [ngClass]="{
          'border-green-300 text-green-300': !_setting?.RequiresRestart,
          'border-yellow text-yellow cursor-pointer hover:bg-yellow hover:text-gray-200': _setting?.RequiresRestart
        }" [@fadeIn]>
        <svg xmlns="http://www.w3.org/2000/svg" class="inline-block w-4 h-4 mr-1" viewBox="0 0 20 20"
          fill="currentColor">
          <path fill-rule="evenodd"
            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
            clip-rule="evenodd" />
        </svg>
        Saved {{ _setting?.RequiresRestart ? ' - Restart required' : '' }}
      </span>

      <span *ngIf="rejected" (click)="resetValue()"
        class="px-1.5 py-0.5 border-red-300 border text-red-300 rounded inline-flex justify-evenly items-center text-xxs hover:bg-red hover:text-white mb-0.5 cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" class="inline-block w-4 h-4 mr-1" *ngIf="rejected" fill="none"
          viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
        Invalid Value
      </span>
    </div>

    <span class="flex flex-row items-center justify-start space-x-2"
      *ngIf="setting?.ReleaseLevel != releaseLevel.Stable || (expertiseLevel | async) === 'developer'">

      <span class="inline-block px-1.5 py-0.5 bg-gray-400 rounded text-xxs text-secondary"
        *appExpertiseLevel="'developer'">{{setting?.Key}}</span>
      <span class="inline-block px-1.5 py-0.5 text-gray-100 bg-yellow-300 rounded text-xxs"
        *ngIf="setting?.ReleaseLevel === releaseLevel.Beta">Beta</span>
      <span class="inline-block px-1.5 py-0.5 text-white bg-red-300 rounded text-xxs"
        *ngIf="setting?.ReleaseLevel === releaseLevel.Experimental">Experimental</span>
    </span>
  </div>


  <!-- Quick Settings -->
  <div *ngIf="quickSettings.length > 0 && !disabled">
    <app-menu-trigger [menu]="quickSettingsMenu" useContent="true" class="text-secondary hover:text-primary">
      <svg xmlns="http://www.w3.org/2000/svg" class="inline-block w-4 h-4" fill="none" viewBox="0 0 24 24"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
      </svg>
      <span class="ml-1 text-xs">Quick Settings</span>
    </app-menu-trigger>

    <app-menu #quickSettingsMenu>
      <app-menu-item *ngFor="let quick of quickSettings" (click)="applyQuickSetting(quick)">
        {{quick.Name}}
      </app-menu-item>
    </app-menu>
  </div>

  <!-- Actual settings input -->
  <ng-container [ngSwitch]="externalOptType(setting)">
    <!-- Security Level Switches -->
    <app-security-setting *ngSwitchCase="optionHint.SecurityLevel" [disabled]="disabled"
      class="w-full mt-2 xl:mt-0 xl:w-auto" [onOffMode]="!(networkRatingEnabled$ | async)" [autoFocus]="!isLocked"
      [setting]="_setting" [ngModel]="_currentValue" (ngModelChange)="updateValue($event, true)">
    </app-security-setting>

    <!-- Rule lists -->
    <ng-container *ngSwitchCase="optionHint.EndpointList">
      <app-rule-list class="w-full mt-4" [readonly]="disabled" [ngModel]="_currentValue" [autoFocus]="!isLocked"
        (ngModelChange)="updateValue($event, true)"></app-rule-list>

      <div class="stacked-values" *ngIf="showStackable">
        <h4>This setting stacks on top of the following <a class="underline text-tertiary hover:text-primary"
            routerLink="/settings" [queryParams]="{setting: setting?.Key}">global setting</a>:</h4>
        <app-rule-list class="w-full mt-4" [readonly]="true" [ngModel]="setting?.GlobalDefault"></app-rule-list>
      </div>
    </ng-container>

    <!-- Filter lists -->
    <ng-container *ngSwitchCase="optionHint.FilterList">
      <app-filter-list class="w-full mt-4" [ngModel]="_currentValue" [autoFocus]="!isLocked"
        (ngModelChange)="updateValue($event, true)">
      </app-filter-list>
    </ng-container>

    <!-- Ordered string lists -->
    <ng-container *ngSwitchCase="optionHint.OrderedList">
      <app-ordered-list class="w-full mt-4" [ngModel]="_currentValue" [autoFocus]="!isLocked"
        (ngModelChange)="updateValue($event, true)" [readonly]="disabled"></app-ordered-list>

      <div class="stacked-values" *ngIf="showStackable">
        <h4>This setting stacks on top of the following <a class="underline text-tertiary hover:text-primary"
            routerLink="/settings" [queryParams]="{setting: setting?.Key}">global setting</a>:</h4>
        <app-ordered-list class="w-full mt-4" [ngModel]="setting?.GlobalDefault" [readonly]="true"></app-ordered-list>
      </div>
    </ng-container>

    <!-- Default if no display hint is given -->
    <ng-container *ngSwitchDefault>
      <!-- basic string array with fixed order on optional stacking -->
      <ng-container *ngIf="setting?.OptType == optionType.StringArray; else: basicSetting">
        <app-ordered-list class="w-full mt-4" fixedOrder="true" [autoFocus]="!isLocked" [ngModel]="_currentValue"
          (ngModelChange)="updateValue($event, true)" [readonly]="disabled">
        </app-ordered-list>

        <div class="stacked-values" *ngIf="showStackable">
          <h4>This setting stacks on top of the following <a class="underline text-tertiary hover:text-primary"
              routerLink="/settings" [queryParams]="{setting: setting?.Key}">global setting</a>:</h4>
          <app-ordered-list class="w-full mt-4" fixedOrder="true" [ngModel]="setting?.GlobalDefault" [readonly]="true">
          </app-ordered-list>
        </div>
      </ng-container>

      <ng-template #basicSetting>
        <!-- basic inputs -->
        <app-basic-setting class="block" [setting]="_setting" [disabled]="disabled" [ngModel]="_currentValue"
          [autoFocus]="!isLocked" (ngModelChange)="updateValue($event)"
          (onBlur)="updateValue(_basicSettingsValueCache!, _currentValue !== _basicSettingsValueCache)">
        </app-basic-setting>
      </ng-template>
    </ng-container>
  </ng-container>

  <span class="unlock-button" [class.bg-blue]="!isLocked" [class.bg-gray-500]="isLocked" *ngIf="lockDefaults"
    (click)="toggleLock()">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-white" viewBox="0 0 20 20" fill="currentColor"
      *ngIf="isLocked">
      <path fill-rule="evenodd"
        d="M4.083 9h1.946c.089-1.546.383-2.97.837-4.118A6.004 6.004 0 004.083 9zM10 2a8 8 0 100 16 8 8 0 000-16zm0 2c-.076 0-.232.032-.465.262-.238.234-.497.623-.737 1.182-.389.907-.673 2.142-.766 3.556h3.936c-.093-1.414-.377-2.649-.766-3.556-.24-.56-.5-.948-.737-1.182C10.232 4.032 10.076 4 10 4zm3.971 5c-.089-1.546-.383-2.97-.837-4.118A6.004 6.004 0 0115.917 9h-1.946zm-2.003 2H8.032c.093 1.414.377 2.649.766 3.556.24.56.5.948.737 1.182.233.23.389.262.465.262.076 0 .232-.032.465-.262.238-.234.498-.623.737-1.182.389-.907.673-2.142.766-3.556zm1.166 4.118c.454-1.147.748-2.572.837-4.118h1.946a6.004 6.004 0 01-2.783 4.118zm-6.268 0C6.412 13.97 6.118 12.546 6.03 11H4.083a6.004 6.004 0 002.783 4.118z"
        clip-rule="evenodd" />
    </svg>

    <svg viewBox="0 0 24 24" class="w-4 h-4 text-white" stroke="currentColor" *ngIf="!isLocked">
      <g fill="none" class="inner">
        <path shape-rendering="geometricPrecision" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M8 20.064V11c0-1.105.895-2 2-2h10.487M8 14h12.776" />
        <path shape-rendering="geometricPrecision" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M11.005 11.49c-.003 0-.005.002-.005.005s.002.005.005.005.005-.002.005-.005-.002-.005-.005-.005M13.548 11.49c-.003 0-.005.002-.005.005s.002.005.005.005.005-.002.005-.005-.002-.005-.005-.005" />
        <path shape-rendering="geometricPrecision" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M12 21v0c4.971 0 9-4.029 9-9v0c0-4.971-4.029-9-9-9v0c-4.971 0-9 4.029-9 9v0c0 4.971 4.029 9 9 9z" />
        <path shape-rendering="geometricPrecision" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M16.088 11.49c-.003 0-.005.002-.005.005s.002.005.005.005.005-.002.005-.005-.003-.005-.005-.005" />
      </g>
    </svg>
  </span>
</div>

<div *ngIf="userConfigured" class="flex justify-end mt-2" [@fadeIn] [@fadeOut]>
  <span class="cursor-pointer text-tertiary hover:text-yellow" tabindex="0" (click)="resetValue()">
    {{resetLabelText}}
  </span>
</div>

<ng-template #helpTemplate>
  <div class="relative flex flex-col overflow-hidden max-w-1/3vw">
    <fa-icon class="absolute top-0 right-0 mt-2 mr-2 opacity-50 cursor-pointer hover:opacity" icon="times"
      (click)="closeHelpDialog()"></fa-icon>
    <h1>{{ _setting?.Name }}</h1>

    <markdown emoji [data]="_setting?.Help" class="flex-grow block overflow-auto"></markdown>
  </div>
</ng-template>
